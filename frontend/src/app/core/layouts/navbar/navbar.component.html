<header class="navbar" role="banner">
  <div class="navbar__left">
    <button
      class="navbar__hamburger"
      type="button"
      (click)="toggleSidebar()"
      [attr.aria-expanded]="isSidebarOpen()"
      aria-controls="aside-menu"
      aria-label="Abrir menu de navegação"
      data-testid="hamburger-button">
      <span class="navbar__hamburger-icon" [class.navbar__hamburger-icon--open]="isSidebarOpen()">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </button>

    <a routerLink="/landing" class="navbar__brand" aria-label="Ir para página inicial">
      <img
        src="images/vn-group.png"
        alt="VN Group Logo"
        class="navbar__logo"
        loading="eager">
    </a>
  </div>

  <div class="navbar__center"></div>

  <div class="navbar__right">
    <!-- Theme Toggle -->
    <button
      class="navbar__icon-button navbar__theme-toggle"
      type="button"
      (click)="toggleTheme()"
      [attr.aria-label]="themeService.isDark() ? 'Mudar para modo claro' : 'Mudar para modo escuro'"
      data-testid="theme-toggle">
      @if (themeService.isDark()) {
        <!-- Sol para modo escuro (clicar muda para claro) -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
          <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/>
        </svg>
      } @else {
        <!-- Lua para modo claro (clicar muda para escuro) -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
          <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/>
        </svg>
      }
    </button>

    <button
      class="navbar__icon-button navbar__notifications"
      type="button"
      aria-label="Notificações"
      data-testid="notifications-button">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
        <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/>
      </svg>
      <span class="navbar__badge" aria-label="3 notificações não lidas">3</span>
    </button>

    <!-- Profile Menu -->
    <div class="navbar__profile">
      <button
        class="navbar__icon-button navbar__user-button"
        type="button"
        [class.navbar__user-button--active]="isProfileMenuOpen()"
        (click)="toggleProfileMenu()"
        aria-label="Menu do usuário"
        [attr.aria-expanded]="isProfileMenuOpen()"
        data-testid="user-menu-button">
        <span class="navbar__user-avatar">
          @if (user(); as u) {
            {{ u.nome.charAt(0).toUpperCase() }}
          } @else {
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
          }
        </span>
      </button>

      <!-- Profile Dropdown -->
      @if (isProfileMenuOpen()) {
        <div class="profile-dropdown" (clickOutside)="closeProfileMenu()">
          <!-- User Info -->
          <div class="profile-dropdown__user">
            <div class="profile-dropdown__avatar">
              @if (user(); as u) {
                {{ u.nome.charAt(0).toUpperCase() }}
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
              }
            </div>
            <div class="profile-dropdown__info">
              <span class="profile-dropdown__name">{{ user()?.nome || 'Usuário' }}</span>
              <span class="profile-dropdown__email">{{ user()?.email || 'email@exemplo.com' }}</span>
              <div class="profile-dropdown__roles">
                @for (role of user()?.roles; track role) {
                  <span class="profile-dropdown__role">{{ role }}</span>
                }
              </div>
            </div>
          </div>

          <div class="profile-dropdown__divider"></div>

          <!-- Menu Items -->
          <div class="profile-dropdown__menu">
            <!-- User Management (Admin/Root only) -->
            @if (showUserManagement) {
              <button type="button" class="profile-dropdown__item" (click)="navigateToUserManagement()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                </svg>
                Gerenciamento de Usuários
              </button>
            }

            <!-- Reset Password -->
            <button type="button" class="profile-dropdown__item" (click)="resetPassword()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
              </svg>
              Alterar Senha
            </button>
          </div>

          <div class="profile-dropdown__divider"></div>

          <!-- Logout -->
          <button type="button" class="profile-dropdown__item profile-dropdown__item--danger" (click)="logout()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M10.09 15.59L11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/>
            </svg>
            Sair da Conta
          </button>
        </div>
      }
    </div>
  </div>
</header>

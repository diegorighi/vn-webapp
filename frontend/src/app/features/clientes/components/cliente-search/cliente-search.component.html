<article class="cliente-search">
  <!-- Header -->
  <header class="cliente-search__header">
    <div class="cliente-search__title-area">
      <h1 class="cliente-search__title">{{ pageTitle }}</h1>
      <p class="cliente-search__subtitle">{{ pageSubtitle }}</p>
    </div>
    <a routerLink="/app/clientes" class="btn btn--ghost">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
      </svg>
      Voltar para Lista
    </a>
  </header>

  <!-- Search Section -->
  <section class="search-section">
    <div class="search-card">
      <h2 class="search-card__title">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
        </svg>
        Buscar Cliente
      </h2>

      <div class="search-field">
        <div class="search-field__input-wrapper">
          <svg class="search-field__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
          </svg>
          <input
            type="text"
            class="search-field__input"
            placeholder="Digite o nome, CPF, email ou telefone do cliente..."
            [value]="searchTerm()"
            (input)="onSearchChange($event)"
            autocomplete="off">
          @if (searchTerm()) {
            <button type="button" class="search-field__clear" (click)="clearSearch()" aria-label="Limpar busca">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
              </svg>
            </button>
          }
        </div>
        <span class="search-field__hint">Digite pelo menos 2 caracteres para buscar</span>
      </div>

      <!-- Search Results -->
      @if (showResults()) {
        <div class="search-results">
          @if (hasResults()) {
            <ul class="search-results__list">
              @for (cliente of filteredClientes(); track cliente.id) {
                <li class="search-results__item">
                  <button
                    type="button"
                    class="search-results__button"
                    [class.search-results__button--selected]="selectedCliente()?.id === cliente.id"
                    (click)="selectCliente(cliente)">
                    <div class="search-results__avatar">
                      {{ cliente.nome.charAt(0) }}{{ cliente.sobrenome.charAt(0) }}
                    </div>
                    <div class="search-results__info">
                      <span class="search-results__name">{{ cliente.nome }} {{ cliente.sobrenome }}</span>
                      <span class="search-results__details">
                        {{ getDocumentoPrincipal(cliente) }} â€¢ {{ getContatoPrincipal(cliente) }}
                      </span>
                    </div>
                    <span class="search-results__status" [class]="'search-results__status--' + cliente.status.toLowerCase()">
                      {{ cliente.status }}
                    </span>
                    @if (selectedCliente()?.id === cliente.id) {
                      <svg class="search-results__check" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                      </svg>
                    }
                  </button>
                </li>
              }
            </ul>
          } @else {
            <div class="search-results__empty">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
              <p>Nenhum cliente encontrado para "{{ searchTerm() }}"</p>
            </div>
          }
        </div>
      }
    </div>

    <!-- Selected Client Card -->
    @if (selectedCliente(); as cliente) {
      <div class="selected-card">
        <h3 class="selected-card__title">Cliente Selecionado</h3>
        <div class="selected-card__content">
          <div class="selected-card__avatar">
            {{ cliente.nome.charAt(0) }}{{ cliente.sobrenome.charAt(0) }}
          </div>
          <div class="selected-card__info">
            <span class="selected-card__name">{{ cliente.nome }} {{ cliente.sobrenome }}</span>
            <span class="selected-card__document">{{ getDocumentoPrincipal(cliente) }}</span>
            <span class="selected-card__contact">{{ getContatoPrincipal(cliente) }}</span>
          </div>
        </div>
        <div class="selected-card__actions">
          <button type="button" class="btn btn--ghost" (click)="clearSearch()">
            Selecionar Outro
          </button>
          <button type="button" class="btn btn--primary" (click)="navigateToCliente()">
            @if (mode() === 'editar') {
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
              </svg>
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
              </svg>
            }
            {{ actionLabel }}
          </button>
        </div>
      </div>
    }
  </section>
</article>
